<%
	import java.text.DateFormat;
	import java.text.SimpleDateFormat;
	import java.util.Map ;

	int currentYear = uicomponent.getCurrentYear() ;
	int currentMonth = uicomponent.getCurrentMonth() ;
	int currentDay = uicomponent.getCurrentDay() ;
	String linkDayNext = uicomponent.event(uicomponent.ACT_NEXT,String.valueOf(uicomponent.TYPE_MONTH)) ;
 	String linkDayPrevious = uicomponent.event(uicomponent.ACT_PREVIOUS,String.valueOf(uicomponent.TYPE_MONTH)) ;
 	String linkYearNext = uicomponent.event(uicomponent.ACT_NEXT, String.valueOf(uicomponent.TYPE_YEAR)) ;
 	String linkYearPrevious = uicomponent.event(uicomponent.ACT_PREVIOUS,String.valueOf(uicomponent.TYPE_YEAR)) ;
 	monthName = uicomponent.getMonthName(currentMonth) ;
 	cssClass = "CalendarContentNomal" ;
 	if(uicomponent.isCurrentMonth(currentMonth, currentYear)) {
		cssClass = "CalendarMatchedEventContent" ;
	}
	Map data = uicomponent.getData() ;
	uiform.begin();
%>
<div class="UIMiniCalendar">
	<div class="MiniCalendarContainer">
		<div class="YearSelector">
			<a href="$linkYearNext" class="RightControlButton">
				<div class="NextYearSelector" title="Previous Year"><span></span></div>
			</a>
			<div class="MonthSelector RightControlButton">
				<table>
					<body>
						<tr>
							<td>
								<a href="$linkDayPrevious">
									<div class="PreviousMonthSelector" title="Previous month"><span></span></div>
								</a>
							</td>
							<td>
								<div class="Title">
								<%
										monthViewAction = uicomponent.TYPE_MONTH +"&"+ uicomponent.YEAR +"="+ currentYear +"&"+ uicomponent.MONTH +"="+ currentMonth +"&"+ uicomponent.DAY + "=1" ;
										yearViewAction = uicomponent.TYPE_YEAR +"&"+ uicomponent.YEAR +"="+ currentYear +"&"+ uicomponent.MONTH +"=0&"+ uicomponent.DAY + "=1" ;
								%>
								<a href="<%=uicomponent.event("GotoDate", monthViewAction)%>">
									$monthName 
								</a>,  
								<a href="<%=uicomponent.event("GotoDate", yearViewAction)%>">
									$currentYear
								</a>
								</div>
							</td>
							<td>
								<a href="$linkDayNext">
									<div class="NextMonthSelector" title="Next month"><span></span></div>
								</a>
							</td>
						</tr>
					</body>
				</table>
			</div>
			<a href="$linkYearPrevious" class="RightControlButton">
				<div class="PreviousYearSelector" title="Previous Year"><span></span></div>
			</a>
			<div style="clear: right;"><span></span></div>
		</div>
		<div class="MonthList">
			<div class="WeekList">
			  <%for(day in uicomponent.getDaysName()) {
				  	cssStyle = "DayTitle" ;
						if(day.equals(uicomponent.SUNDAY)) cssStyle = "SundayTitle" ;
				%>
			<div class="$cssStyle"><%=day.substring(0,1)%></div>
			  <%}%>
  					<div style="clear: left;"><span></span></div>
  				</div>
  				<div class="DayList">
  					<table class="UIGrid" id="" cellspacing="0" borderspacing="0">
  						<tbody>
  						<%
					week = 0 ; 
					dayOfMonth = 1 ;
					validDay = 0 ;
					daysInMonth = uicomponent.getDaysInMonth(currentMonth, currentYear) ;
					while ( week++ < uicomponent.getWeeksOfTheMonth(currentYear, currentMonth, 1)  ) {
				    println "<tr>";
				    dayOfWeek = 0 ;
				    while (dayOfWeek++ < 7) {
				    	startDayOfWeek = uicomponent.getDayOfWeek(currentYear, currentMonth, dayOfMonth) ;
				      if (week == 1 && startDayOfWeek == dayOfWeek) {
				        validDay = 1;
				      } else if (validDay == 1 && dayOfMonth > daysInMonth) {
				        validDay = 0;
				      }
				      if (validDay) {
				       	clazz = "" ;
				       	highlight = "" ;
						    if(data.get(dayOfMonth) != null) {
						    	highlight = "Highlight" ;
						    } 
					      if (uicomponent.isCurrentDay(dayOfMonth, currentMonth, currentYear )) {
						       clazz = "Today";
						     } else  {
						       if(dayOfMonth == currentDay) {
						       	clazz = "SelectedDay";
						       }  
						     }
						   dayActionLink = uicomponent.TYPE_DATE +"&"+ uicomponent.YEAR +"="+ currentYear +"&"+ uicomponent.MONTH +"="+ currentMonth +"&"+ uicomponent.DAY + "=" + dayOfMonth ;
				       actionLink = uicomponent.event("GotoDate", dayActionLink) ;
				       println "<td class=\"$highlight $clazz\"><a href=\"$actionLink\"><div class=\"MiniCalendarActions\">$dayOfMonth</div></a></td>" ;
				        dayOfMonth++ ;
				      } else {
				        println "<td>&nbsp;</td>" ;
				      }
				    }
				    println "</tr>" ;
	  			}	
	  			 
				%>
  				</tbody>
  			</table>
  						
    	</div>
  	</div>
	  <div class="TimeSelector">
			<div class="RightTimeSelector">
				<div class="LeftTimeSelector">
					<div class="CenterTimeSelector">
						<%
							String style = "HH:mm:ss" ;
							DateFormat df = new SimpleDateFormat(style) ;
							println df.format(uicomponent.getCurrentDate()) ;
						%>
					</div>
				</div>
			</div>
		</div>     
	</div>
</div>
<%uiform.end();%>